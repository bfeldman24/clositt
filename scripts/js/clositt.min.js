var firebase={$:null,authClient:null,userid:null,username:null,email:null,isLoggedIn:false,url:"https://clothies.firebaseio.com/",userPath:"userdata",init:function(){firebase.$=new Firebase(firebase.url);firebase.authClient=new FirebaseSimpleLogin(firebase.$,firebase.checkActiveUser)},checkActiveUser:function(b,a){if(b){console.log(b);Messenger.error("Incorrect login information");firebase.loggedOutErrorCallback()}else{if(a){firebase.handleUserData(a);firebase.updateLoggedInDropdownMenu();firebase.isLoggedIn=true}else{console.log("logged out");firebase.loggedOutCallback()}}if(b||!a){firebase.updateLoggedOutDropdownMenu();firebase.isLoggedIn=false}},handleUserData:function(a){firebase.$.child(firebase.userPath).child(a.id).child("name").on("value",function(b){firebase.username=b.val();firebase.userid=a.id;firebase.email=a.email;if(firebase.username===null){console.log("No User Found")}else{$("#user-name").html(firebase.username.split(" ")[0]);firebase.userDataAvailableCallback(firebase.username)}firebase.logginCallback()})},login:function(b,a,c){firebase.authClient.login("password",{email:b,password:a,rememberMe:c})},signup:function(c,b,e,a,d){firebase.authClient.createUser(c,b,function(g,f){firebase.register(g,f,b,e,a,d)})},register:function(d,a,c,h,b,g){if(!d){var f=stringFunctions.toTitleCase(b);var e={email:a.email,name:f};if(g!=null){g=g.toLowerCase();e.username=g}firebase.$.child(firebase.userPath).child(a.id).set(e);firebase.login(a.email,c,h)}else{Messenger.error(d)}},addToWaitingList:function(a,b){var c=false;if(a.length>3&&a.indexOf("@")>0&&a.indexOf(".")>0){firebase.$.child("waitinglist").push(a);Messenger.success("Thanks for joining Clositt! You have been placed on our waiting list!");c=true}else{Messenger.error("Your email address is not valid! Please try again.")}if(typeof b=="function"){b(c)}},logginCallback:function(){if(typeof loggedIn=="function"){loggedIn()}},loggedOutCallback:function(){if(typeof loggedOut=="function"){loggedOut()}firebase.sendToWelcomePage()},loggedOutErrorCallback:function(){if(typeof loggedOutError=="function"){loggedOutError()}firebase.sendToWelcomePage()},userDataAvailableCallback:function(a){if(typeof userDataReady=="function"){userDataReady(a)}},updateLoggedInDropdownMenu:function(){$("#account-dropdown").html("").append($('<li><a href="settings.php">Account Settings</a></li>')).append($('<li class="divider"></li>')).append($('<li><a href="javascript:firebase.logout();">Logout</a></li>'))},updateLoggedOutDropdownMenu:function(){$("#account-dropdown").html("").append($('<li><a href="login.php">Login</a></li>')).append($('<li class="divider"></li>')).append($('<li><a href="signup.php">Sign Up</a></li>'))},logout:function(){firebase.authClient.logout();$.post("../../auth.php",function(){location.href="../../"}).fail(function(){$.post("auth.php",function(){location.href="./"})})},sendToWelcomePage:function(){if(location.href.indexOf("signup")<0&&location.href.indexOf("welcome")<0&&location.href.indexOf("login")<0&&location.href.indexOf("contact")<0){if(location.href.indexOf("welcome.php")<0){location.href="/welcome.php"}}}};var stringFunctions={toTitleCase:function(a){return a.toLowerCase().replace(/\b[a-z]/g,function(b){return b.toUpperCase()})}};var Messenger={id:"messenger",position:"top",align:"center",timeout:4000,defaultTimeout:4000,width:300,height:75,messageBoxTemplate:$('<ul class="messenger messenger-fixed messenger-theme-future"></ul>'),alertTemplate:$('<li class="messenger-message-slot  "><div class="messenger-message"><div class="messenger-message-inner"></div><div class="messenger-spinner"><span class="messenger-spinner-side messenger-spinner-side-left"><span class="messenger-spinner-fill"></span></span><span class="messenger-spinner-side messenger-spinner-side-right"><span class="messenger-spinner-fill"></span></span></div></div></li>'),init:function(){if(Messenger.align=="center"){var b=($(document).width()/2)-(Messenger.width/2)}else{var b=100}if(Messenger.position=="top"){var a=50}else{var a=$(document).height()-Messenger.height}$("body").append(Messenger.messageBoxTemplate.attr("id",Messenger.id).css("display","none").css("top",a+"px").css("left",b+"px").css("min-width",Messenger.width+"px"))},alert:function(d,a){var b="alert-success";if(a=="error"){b="alert-error"}else{if(a=="info"){b="alert-info"}}var c=Messenger.alertTemplate.clone();c.children("div").first().addClass(b);c.find(".messenger-message-inner").first().text(d);$("#"+Messenger.id).append(c);$("#"+Messenger.id).css("display","block");setTimeout(function(){c.remove();if($(".messenger-message-slot").size()<=0){$("#"+Messenger.id).css("display","none")}},Messenger.timeout);return true},success:function(a){Messenger.alert(a,"success")},error:function(a){Messenger.alert(a,"error")},info:function(a){Messenger.alert(a,"info")}};var pagePresenter={init:function(){$("#subheader-navbar").show("fast");$("#brand").css("position","fixed");$("#user-dropdown").css("position","fixed");$(document).ready(function(){$(window).scroll(pagePresenter.handleScrollEvents);pagePresenter.handleScrollEvents()})},handleScrollEvents:function(){pagePresenter.toggleHeader();if(typeof gridEvents=="object"){gridEvents.continuousScroll()}},toggleHeader:function(){var b=45;var a=$(window).scrollTop();if(a>b&&$("#subheader-navbar").css("position")!="fixed"){$("#subheader-navbar").css("position","fixed");$("#subheader-navbar").css("top","0");$("#brand-fixed-background").show("blind","fast");if($("#filter-float").length>0){$("#filter-float").css("top",b+"px")}if($("#feedSettings-float").length>0){$("#feedSettings-float").css("top",b+"px")}}else{if(a<=b){if($("#filter-float").length>0){$("#filter-float").css("top",(84-a)+"px")}if($("#feedSettings-float").length>0){$("#feedSettings-float").css("top",(84-a)+"px")}if($("#subheader-navbar").css("position")=="fixed"){$("#subheader-navbar").css("position","relative");$("#subheader-navbar").css("top","30px");$("#brand-fixed-background").hide("blind","fast")}}}},handleImageNotFound:function(a){$(a).attr("src","css/images/missing.png");return true}};var gridPresenter={init:function(){gridEvents.init()},alignDefaultGrid:function(a){if(a==null){a="product-grid"}var b=gridPresenter.getDefaultColumns();$(".addToClosetBtn").tooltip();$(".tagOutfitBtn").tooltip();$(".showComments").tooltip();gridPresenter.alignGrid(a,b,200,270,25);closetFormPresenter.markUsersClositItems()},getDefaultColumns:function(){var b=1;var a=$(document).width();if(a>975){b=4}else{if(a>750){b=3}else{if(a>525){b=2}}}return b},alignGrid:function(b,f,d,a,k,i){var h=0;var g=0;var e=$("#"+b).children("div[aligned=true]").size();var j="px";i=typeof i!=="undefined"?i:0;var c=e;$("#"+b).children("div[aligned=true]").slice(-1*f).each(function(){var l=c++%f;if(l>=f-1){h=0;g=parseFloat($(this).css("top"),10)+a+k+i}else{h=parseInt($(this).css("left"),10)+d+k;g=parseFloat($(this).css("top"),10)}});$("#"+b).css("position","relative").css("margin","0 auto").css("width",(f*(d+k))+"px");$(".pageEndSpacer").remove();$("#"+b).children("div[aligned!=true][ignore!=true]").each(function(){var l=e%f;$(this).find(".picture").css("width",d+j);$(this).find(".picture").css("height",a+j);$(this).css("position","absolute");$(this).css("left",h+j);$(this).css("top",g+j);$(this).attr("aligned",true);if(l>=f-1){h=0;g+=a+k+i}else{h+=d+k}e++});$("#"+b).append($("<div>").addClass("pageEndSpacer").css("top",g+"px"))},resizeImages:function(b){var f=$(b.currentTarget);var e=f.css("height");var a=f.css("width");if(e==undefined||e==null||e.trim()==""){e=cellHeight;a=cellWidth}else{e=parseFloat(e,10);a=parseFloat(a,10)}var d=cellWidth*(e/a);if(d<=cellHeight){f.css("width",cellWidth+unit)}else{var c=cellHeight/(e/a);f.css("height",cellHeight+unit)}},showContent:function(f){var e=$("#product-grid").children("div[aligned=true]").last().css("top");if(e==undefined||e==null||e.trim()==""){e=0}else{e=parseFloat(e,10)}if(e<=($(window).height()+$(window).scrollTop()+125)){if(productPresenter.filterStore!=null){var g=$();var d=productPresenter.filterStore;var a=productPresenter.productIndex;for(var c=a;c<a+f;c++){if(d[Object.keys(d)[c]]!=null){var b=productPresenter.getProductTemplate(Object.keys(d)[c]).css("position","absolute").css("left","-9999px");g=g.add(b)}}productPresenter.productIndex+=f;$("#product-grid").append(g);gridPresenter.alignDefaultGrid();$("#loadingMainContent").hide()}}},beginTask:function(){$("#product-grid").children().remove();$("#product-grid").append($("<br><br><br><br>"));$("#loadingMainContent").show()},endTask:function(){$("#loadingMainContent").hide()}};var gridEvents={init:function(){gridEvents.overlayEvent();$(document).on("click",".addToClosetBtn",closetFormPresenter.showClosetForm);$(document).on("submit",".addToClosetForm > form",closetFormPresenter.addToCloset);$(document).on("click",'.addToClosetForm > form input[type="radio"]',function(a){$(a.currentTarget).closest("form").submit()});$(document).on("click",".tagOutfitBtn",tagPresenter.showTagForm);$(document).on("submit",".addTagForm > form",tagPresenter.addTag)},overlayEvent:function(){$(document).on("mouseenter",".outfit",gridEvents.showOverlay).on("mouseleave",".outfit",gridEvents.hideOverlay)},showOverlay:function(){$(this).children(".overlay").not(".alwaysVisible").first().fadeIn("slow")},hideOverlay:function(){$(this).children(".overlay").not(".alwaysVisible").first().fadeOut("slow");if(reviewsPresenter!=null){var a=$(this).find("a[pid]").first().attr("pid");reviewsPresenter.hideReview(reviewsPresenter.getReviewBlock(a))}},continuousScroll:function(){gridPresenter.showContent(15)}};var productPresenter={splitValue:30,productIndex:0,clothingStore:[],filterStore:[],populateStoreCallback:null,init:function(){firebase.$.child("clositt").once("value",productPresenter.setup)},setup:function(a){productPresenter.showCompanyProducts(a);gridPresenter.alignDefaultGrid();$("body").css("min-height",$(window).height());productPresenter.productIndex+=productPresenter.splitValue},populateStore:function(a){productPresenter.populateStoreCallback=a;firebase.$.child("clositt").once("value",productPresenter.closetSetup)},closetSetup:function(a){productPresenter.clothingStore=a.child("products").val();if(productPresenter.populateStoreCallback!=null&&typeof productPresenter.populateStoreCallback=="function"){productPresenter.populateStoreCallback()}},showCompanyProducts:function(c){productPresenter.clothingStore=c.child("products").val();productPresenter.filterStore=c.child("products").val();var a=c.child("companies").val();var e=c.child("customers").val();var b=c.child("categories").val();var d=c.child("prices").val();productPresenter.refreshProducts();filterPresenter.createFilters(a,e,b,d)},getProductTemplate:function(i){i=productPresenter.formatSku(i);var f=productPresenter.clothingStore[i];var b=f.o;var d=f.u;var o=f.a;var e=f.l;var k=f.i;var r=f.n;var a=f.rc==null?"":f.rc;var l=f.s;var p=f.p==null||isNaN(f.p)?"":"$"+Math.round(f.p);var m=f.fp;var j=f.owner;var h=f.closet;var q=Math.floor(Math.random()*3)+1;var c="";if(q==1){c="shadow"}var n="";var g='<div class="outfit" '+n+">";g+='<div class="picture"><a href="'+e+'" pid="'+l+'" target="_blank"><img src="'+k+'" class="'+c+'" onerror="return pagePresenter.handleImageNotFound(this)"/></a></div>';g+='<div class="overlay">';g+='<div class="topleft">';g+='<div class="tagOutfitBtn" data-toggle="tooltip" data-placement="left" title="Tagitt"><i class="icon-tags icon-white"></i></div>';g+="</div>";g+='<div class="topright">';g+='<div class="addToClosetBtn" data-toggle="tooltip" data-placement="right" title="Add to Closet"><img id="hanger-'+l+'" class="hanger-icon" src="css/images/hanger-icon-white.png" /><i class="icon-plus-sign icon-white hanger-plus"></i></div>';g+="</div>";g+='<div class="bottom">';g+='<div class="productActions" >';g+='<div data-toggle="tooltip" data-placement="top" title="Show Comments" class="showComments"><span class="numReviews">'+a+'</span><i class="icon-comment icon-white"></i></div>';g+="</div>";if(j!=null&&h!=null){g+='<div class="productSubHeader" >';g+='<div class="outfitFeedOwner"><span class="outfitOwner">'+j+"'s</span><span>&nbsp;\""+h+'" clositt</span></div>';g+="</div>"}g+='<div class="companyName">'+b+"</div>";g+='<div class="price">'+p+"</div>";g+='<div class="name">'+r+"</div>";g+="</div>";g+='<div class="product-comments"></div>';g+="</div>";g+='<div class="clear"></div>';g+="</div>";return $(g)},getClosetItemTemplate:function(g){var a=productPresenter.clothingStore[g];var b=a.o;var e=a.l;var f=a.i;var c=a.n;var d='<div class="outfit">';d+='<div class="picture"><a href="'+e+'" target="_blank" pid="'+g+'"><img src="'+f+'" /></a></div>';d+='<div class="overlay">';d+='<div class="bottom">';d+='<div class="companyName">'+b+"</div>";d+='<div class="name">'+c+"</div>";d+="</div>";d+="</div>";d+='<div class="clear"></div>';d+="</div>";return $(d)},refreshImages:function(){var a=new Date();$(".picture > a > img").each(function(){var c=$(this).attr("src");var b="?";var d=c.indexOf(b);if(d>=0){b="&"}$(this).attr("src",c+b+"rldimg="+a.getTime())});return true},refreshFilteredProducts:function(){gridPresenter.endTask();productPresenter.productIndex=0;gridPresenter.showContent(15)},refreshProducts:function(){gridPresenter.beginTask();var c=$("#product-grid");for(var b=0;b<productPresenter.splitValue;b++){var d=Math.floor(Math.random()*Object.keys(productPresenter.clothingStore).length);var a=productPresenter.getProductTemplate(Object.keys(productPresenter.clothingStore)[d]);c.append(a)}gridPresenter.endTask();gridPresenter.alignDefaultGrid();productPresenter.productIndex=0;productPresenter.filterStore=productPresenter.clothingStore},getProductsFromSkuList:function(b){var d=new Object;for(var a=0;a<b.length;a++){var c=productPresenter.formatSku(b[a]);d[b[a]]=productPresenter.clothingStore[c]}return d},formatSku:function(a){return a.substring(a.indexOf("_")+1)}};var filterPresenter={allFilters:null,init:function(){filterPresenter.allFilters=[];$(document).on("click","#filter-toggle",filterPresenter.filterPanelToggle);$("#filter-float").on("click","input",function(){setTimeout(filterPresenter.onFilterSelect,50)})},createFilters:function(a,d,b,c){c=c.sort(function(i,h){return parseInt(i)-parseInt(h)});a=a.sort();d=d.sort();b=b.sort();var g=new Array();var f=c.length;g[0]=0;var e=0;while(g[e]<c[f-1]&&e<5){g[e+1]=g[e]+50;e++}if(g[e]<c[f-1]){g[e]=(Math.round(c[f-1]/50)*50)+50}$("#filter-float").append($("<h4>").html("Shop For:"));$.each(d,function(h,i){filterPresenter.allFilters.push(i);$("#filter-float").append($("<div>").addClass("controls").append($("<label>").addClass("checkbox").append($("<input>").attr("type","checkbox").attr("name","customer").attr("value",i)).append($("<span>").html(i))))});$("#filter-float").append($("<br>")).append($("<h4>").html("Category:"));$.each(b,function(h,i){filterPresenter.allFilters.push(i);$("#filter-float").append($("<div>").addClass("controls").append($("<label>").addClass("checkbox").append($("<input>").attr("type","checkbox").attr("name","category").attr("value",i)).append($("<span>").html(i))))});$("#filter-float").append($("<br>")).append($("<h4>").html("Brands:"));$.each(a,function(h,i){filterPresenter.allFilters.push(i);$("#filter-float").append($("<div>").addClass("controls").append($("<label>").addClass("checkbox").append($("<input>").attr("type","checkbox").attr("name","company").attr("value",i)).append($("<span>").html(i))))});$("#filter-float").append($("<br>")).append($("<h4>").html("Price:"));for(var e=0;e<g.length-1;e++){$("#filter-float").append($("<div>").addClass("controls").append($("<label>").addClass("checkbox").append($("<input>").attr("type","checkbox").attr("name","filterprice").attr("value",g[e]).attr("max",g[e+1])).append($("<span>").html("$"+g[e]+" - $"+g[e+1]))))}$("#filter-float").append($("<br>")).append($("<h4>").html("Colors:"));$("#filter-float").append(colorPresenter.getColorFilters());$("#filter-float").append($("<br><br><br><br><br><br><br>"));filterPresenter.showFilter()},onFilterSelect:function(){productPresenter.filterStore=[];window.scrollTo(0,0);gridPresenter.beginTask();var d=new Object();var c=$("#search-bar").val().trim().length>0;var b=false;var a=new Array("customer","filterprice","category","company");$.each(a,function(f,e){d[e]=new Array();$("#filter-float").find('input[name="'+e+'"]:checked').each(function(){b=true;var h=$(this).attr("name");var j=$(this).val().toLowerCase();var j=j.replace(/'/g,"\\'");if(h=="filterprice"){var i=parseInt(j);var g=parseInt($(this).attr("max"));if(d.belowPrice==null||g>d.belowPrice){d.belowPrice=g}if(d.abovePrice==null||i<d.abovePrice){d.abovePrice=i}}else{d[e].push(j)}})});d.colors=colorPresenter.getSelectedColors();if(d.colors!=null&&d.colors.length>0){b=true}if(c){searchController.search(d)}else{if(b){searchController.getProducts(d,null,searchController.showResults)}else{$(".noresults").remove();productPresenter.refreshProducts()}}},formatSelectedValued:function(a){var b="";if(a!=null&&a.length>0){b+="( ";$.each(a,function(c,d){b+=d+" || "});b=b.substring(0,b.length-4);b+=") && "}return b},filterPanelToggle:function(){$("#filter-float").toggle("slide",1000);if(isNaN(parseInt($("#product-grid").css("left")))||parseInt($("#product-grid").css("left"))==0){$("#product-grid").animate({left:"100px"},1000);$("#filter-toggle").animate({left:"165px"},1000);$("#filter-toggle").text("Hide Filter")}else{$("#product-grid").animate({left:"0px"},1000);$("#filter-toggle").animate({left:"-37px"},1000);$("#filter-toggle").text("Show Filter")}},clearFilters:function(){$("#filter-float").find("input").prop("checked",false)},hideFilterPanel:function(){if($("#filter-float").is(":visible")){$("#filter-float").hide("slide",500);$("#product-grid").animate({left:"0px"},500);$("#filter-toggle").animate({left:"-37px"},500);$("#filter-toggle").text("Show Filter")}},showFilter:function(){if(!$("#review-form").is(":visible")){$("#filter-float").show("slide",500);$("#product-grid").animate({left:"100px"},500);$("#filter-toggle").animate({left:"165px"},500);$("#filter-toggle").text("Hide Filter")}}};var tagPresenter={allTags:null,init:function(){tagPresenter.getAllTagNames()},showTagForm:function(c){var a=c.currentTarget;if($(a).parent().parent().find(".addTagForm").length>0){$(a).parent().parent().children(".addToClosetForm").tooltip("destroy");$(a).parent().parent().children(".addToClosetForm").remove();$(a).parent().parent().children(".addTagForm").tooltip("destroy");$(a).parent().parent().children(".addTagForm").remove();$(a).parent().parent().children(".topright").show()}else{$(a).parent().siblings(".topright").hide();$(a).parent().parent().append($("<div>").addClass("addTagForm").append($("<form>").append($("<div>").addClass("controls").append($("<input>").attr("type","text").attr("name","newTag").addClass("newTag"))).append($("<input>").attr("type","submit").css("display","none"))));var b=$(a).parent().parent().children(".addTagForm");b.tooltip({title:"Press Enter to add tag",placement:"bottom"});b.show();b.find("input").first().focus()}},addTag:function(d){d.preventDefault();var c=d.currentTarget;var a=$(c).parent().parent().prev().find("a").attr("pid");var b=$(c).find('input[name="newTag"]').val().trim();if(b.length>0){try{firebase.$.child("store/tags").child(b.toLowerCase()).child("items").push(a,function(f){if(f){Messenger.error("Tag could not be saved. "+f)}else{Messenger.timeout=1750;Messenger.success('Tag "'+b+'" was saved!');Messenger.timeout=Messenger.defaultTimeout;$(c).parent().prevAll(".topright").show();$(c).parent().remove()}})}catch(e){Messenger.error("Tag could not be saved. "+e);return false}}return false},getAllTagNames:function(){firebase.$.child("store/tags").once("value",function(a){tagPresenter.allTags=new Array();a.forEach(function(b){tagPresenter.allTags.push(b.name())});$("#tags").autocomplete({source:tagPresenter.allTags})})}};var searchController={results:null,init:function(){$("#search-bar").on("keyup",searchController.showClearBtn);$("#search-bar").on("keypress",searchController.searchOnEnter);$("#search-form").submit(searchController.search);$("#seach-bar-icon").on("click",searchController.searchBarSubmit);$("#search-clear-btn").click(searchController.clearSearch);$("#search-bar-sort").change(searchController.sortBy)},searchOnEnter:function(a){if(a.which==13){searchController.searchBarSubmit(a)}},searchBarSubmit:function(c){c.preventDefault();var b=$("#search-bar").val().trim();if(b.charAt(0)=="#"){var a=b.substring(1);searchController.getProductsWithTag(a,searchController.showResults)}else{if(b==""){filterPresenter.onFilterSelect()}else{searchController.search()}}},search:function(l){var q=$("#search-bar").val().toLowerCase().trim();var a=null;var t=null;var s=q;var k=q.replace(/[^A-Za-z0-9\w\s]/gi,"");var h=new Date().getTime();firebase.$.child("search").child(k).child(h).set({user:firebase.userid});if(q.indexOf("$")>0||q.indexOf("dollar")>0){var f=q.match(/\d+/g);f.sort(searchController.sortLowestToHighest);var b=parseInt(f[0]);var c=parseInt(f[f.length-1]);if(f.length>1&&(/between|from/gi).test(q)){t=b;a=c}else{if((/above|over|more than|more then/gi).test(q)){t=b;a=99999}else{a=b;t=0}}var p=new RegExp("\\$|dollar|above|over|under|below|more than|more then|less than|less then|between|from|to|"+b+"|"+c,"gi");s=s.replace(p,"").trim()}s=s.replace(/[^A-Za-z0-9\w\s]/gi,"");s=s.replace(/(\b(\w{1,2})\b(\s|$))/gi,"");s=s.replace(/(for|with|that|has|like)(\s|$)/gi,"");var o=s.split(" ");var n=null;if(l==null){var g=filterPresenter.allFilters.join("|").toLowerCase().trim();g=g.replace(/s?(?=\s|\||$)/gi,"");g=g.replace(/sse/gi,"ss");var j=new RegExp(searchController.regexEscape(g),"gi");n=s.match(j);if(n==null){n=[]}searchController.getAdditionalFiltersFromTags(n,o);filterPresenter.clearFilters();l={};if(n!=null&&n.length>0){searchController.getAdditionalFilters(n);for(var r=0;r<n.length;r++){var d=$("#filter-float").find('input[value^="'+searchController.toTitleCase(n[r])+'"]');if(d!=null){d.prop("checked",true);var m=d.attr("name").toLowerCase();if(l[m]==null){l[m]=[]}l[m].push(d.val().toLowerCase())}}}if(t!=null||a!=null){var d=$("#filter-float").find('input[name="filterprice"]');l.belowPrice=a;l.abovePrice=t;d.each(function(){var i=parseInt($(this).val());var u=parseInt($(this).attr("max"));if(i<a&&u>t){$(this).prop("checked",true)}})}if(n!=null&&n.length>0){j=new RegExp(searchController.regexEscape(n.join("|")),"gi");s=s.replace(j,"");s=s.replace(/(\b(\w{1,2})\b(\s|$))/gi,"");s=s.trim();o=s.split(" ")}var e=colorPresenter.getColorNames().join("|").toLowerCase().trim();var j=new RegExp(searchController.regexEscape(e),"gi");matchingColors=s.match(j);if(matchingColors==null){matchingColors=[]}searchController.getAdditionalColorsFromTags(matchingColors,o);if(matchingColors!=null&&matchingColors.length>0){l.colors=matchingColors}}searchController.getProducts(l,o,searchController.showResults)},getProducts:function(f,h,g){var i={};gridPresenter.beginTask();var c=h!=null&&h!=""&&!(h.length==1&&h[0]=="")&&h.length>0;var b=null;if(c){var e=h.join("|").toLowerCase().trim();b=new RegExp(searchController.regexEscape(e),"gi")}if(f!=null){var a=(f.company!=null&&Object.keys(f.company).length>0)||(f.customer!=null&&Object.keys(f.customer).length>0)||(f.category!=null&&Object.keys(f.category).length>0);var d=f.colors!=null&&f.colors.length>0;firebase.$.child("store").once("value",function(l){l.child("products").forEach(function(n){if(f.company==null||f.company.length<=0||$.inArray(n.name(),f.company)>=0){n.forEach(function(o){if(f.customer==null||f.customer.length<=0||$.inArray(o.name(),f.customer)>=0){o.forEach(function(p){if(f.category==null||f.category.length<=0||$.inArray(p.name(),f.category)>=0){p.forEach(function(x){var v=x.name();var w=i[v];if(w==null){w=productPresenter.clothingStore[v];if(w!=null){w.rank=0}}else{w.rank+=1}if(w!=null){if((!f.belowPrice||w.p<=f.belowPrice)&&(!f.abovePrice||w.p>=f.abovePrice)){var y=false;if(c){var t=w.n.toLowerCase().match(b);if(t!=null){w.rank+=t.length*2;y=true}}var u=false;if(d){for(var s=0;s<f.colors.length;s++){var r=f.colors[s].toLowerCase();if(l.hasChild("colors/"+r+"/"+v)){var q=l.child("colors/"+r+"/"+v).val();w.rank+=q;u=true}}}if((u||!d)&&(a||d||y)){i[v]=w}}}})}})}})}});if(c){for(var m=0;m<h.length;m++){var j=h[m].replace(/[^A-Za-z0-9\w\s '\-\$\.]/gi,"").toLowerCase();var k=searchController.getMatchingChild(l.child("tags"),j);if(k!=null){k.forEach(function(u){var s=u.val();var t=i[s];if(t==null&&!a){t=productPresenter.clothingStore[s];if(t!=null){t.rank=1}}else{if(t!=null){t.rank+=5}}if(t!=null&&!a){if((!f.belowPrice||t.p<=f.belowPrice)&&(!f.abovePrice||t.p>=f.abovePrice)){var v=false;var q=t.n.toLowerCase().match(b);if(q!=null){t.rank+=q.length*2}var r=false;if(d){for(var p=0;p<f.colors.length;p++){var o=f.colors[p].toLowerCase();if(l.hasChild("colors/"+o+"/"+s)){var n=l.child("colors/"+o+"/"+s).val();t.rank+=n;r=true}}}if(r||!d){i[s]=t}}}})}}}g(i)})}},getProductsWithTag:function(a,b){$("#product-grid").children().remove();$("#loadingMainContent").show();firebase.$.child("store/tags").once("value",function(e){var f={};var c=a.replace(/[^A-Za-z0-9\w\s '\-\$\.]/gi,"").toLowerCase();var d=searchController.getMatchingChild(e,c);if(d!=null){d.forEach(function(h){var i=h.val();var g=productPresenter.clothingStore[i];if(g!=null){if(g.s in f){g=f[g.s];g.rank+=10}else{g.rank=0;f[g.s]=g}}})}b(f)},this)},showResults:function(c){c=searchController.orderResults(c);productPresenter.filterStore=c;$("#loadingMainContent").hide();if(Object.keys(c).length>0){productPresenter.refreshFilteredProducts()}else{var b=$("#search-bar").val().trim();var a="";if(b==""){a="There are no macthing outfits!"}else{a="There are no outfits that matched: '"+b+"'! Try using another way to describe what you are looking for."}$("#product-grid").html($("<div>").text(a))}},showClearBtn:function(){if(!$("#search-clear-btn").is(":visible")&&$("#search-bar").val().trim().length>0){$("#search-clear-btn").show()}},sortBy:function(){gridPresenter.beginTask();searchController.showResults(productPresenter.filterStore)},getSortFunction:function(){var b=$("#search-bar-sort").val();var a=null;switch(b){case"pricelowtohigh":a=searchController.sortPriceLowToHigh;break;case"pricehightolow":a=searchController.sortPriceHighToLow;break;case"mostpopular":a=searchController.sortMostPopular;break;case"mostdiscussed":a=searchController.sortMostDiscussed;break;default:a=searchController.sortRanks;break}return a},orderResults:function(e){var d=[];var c={};for(var b=0;b<Object.keys(e).length;b++){d.push(e[Object.keys(e)[b]])}var a=searchController.getSortFunction();d.sort(a);for(var b=0;b<d.length;b++){c[b+"_"+d[b]["s"]]=d[b]}return c},sortRanks:function(d,c){return c.rank-d.rank},sortPriceLowToHigh:function(d,c){return d.p-c.p},sortPriceHighToLow:function(d,c){return c.p-d.p},sortMostPopular:function(d,c){return c.cc-d.cc},sortMostDiscussed:function(d,c){return c.rc-d.rc},sortLowestToHighest:function(d,c){return d-c},clearSearch:function(a){a.preventDefault();$("#search-bar").val("");$("#loadingMainContent").show();$("#search-clear-btn").hide();filterPresenter.clearFilters();productPresenter.refreshProducts()},getAdditionalFilters:function(a){if(($.inArray("dress",a)>=0||$.inArray("skirts",a)>=0||$.inArray("ann taylor",a)>=0||$.inArray("loft",a)>=0)&&$.inArray("women",a)<0){a.push("women")}},getAdditionalFiltersFromTags:function(b,a){if($.inArray("top",a)>=0||$.inArray("tops",a)>=0){b.push("polos");b.push("shirts");b.push("sweaters");b.push("t's & tops");b.push("top")}if($.inArray("bottom",a)>=0||$.inArray("bottoms",a)>=0){b.push("jeans");b.push("pants");b.push("skirts");b.push("bottom")}},getMatchingChild:function(b,a){var c=null;if(a==null||a.trim()==""){return null}if(b.hasChild(a)){c=b.child(a+"/items")}else{if(b.hasChild(a+"s")){c=b.child(a+"s/items")}else{if(b.hasChild(a+"es")){c=b.child(a+"es/items")}else{if(b.hasChild(a+"ed")){c=b.child(a+"ed/items")}else{if((a.charAt(a.length-1)=="s"||a.charAt(a.length-1)=="y")&&b.hasChild(a.substring(0,a.length-1))){c=b.child(a.substring(0,a.length-1)+"/items")}else{if(a.lastIndexOf("es")==(a.length-2)&&b.hasChild(a.substring(0,a.length-2))){c=b.child(a.substring(0,a.length-2)+"/items")}else{if(a.lastIndexOf("ed")==(a.length-2)&&b.hasChild(a.substring(0,a.length-2)+"es")){c=b.child(a.substring(0,a.length-2)+"es/items")}else{if(a.charAt(a.length-1)=="y"&&b.hasChild(a.substring(0,a.length-1)+"s")){c=b.child(a.substring(0,a.length-1)+"s/items")}else{if(a.charAt(a.length-1)=="y"&&b.hasChild(a.substring(0,a.length-1)+"es")){c=b.child(a.substring(0,a.length-1)+"es/items")}}}}}}}}}return c},getAdditionalColorsFromTags:function(b,a){},regexEscape:function(a){return a.replace(/[-\/\\^$*+?.()[\]{}]/g,"\\$&")},toTitleCase:function(a){return a.replace(/\w\S*/g,function(b){return b.charAt(0).toUpperCase()+b.substr(1).toLowerCase()})}};var reviewsPresenter={cachedReviews:null,currentReviewFB:null,init:function(){reviewsPresenter.cachedReviews=new Object();$(document).on("click",".showComments",reviewsPresenter.showReview);$(document).on("click",".review-add-btn",reviewsPresenter.saveReview);$(document).on("click",".review-mask",reviewsPresenter.hideReview);$(document).on("mouseenter",".review-rating .review-star",reviewsPresenter.showFilledStars);$(document).on("mouseleave",".review-rating",reviewsPresenter.resetRating);$(document).on("click",".review-rating .review-star",reviewsPresenter.chooseRating)},showReview:function(c){var a=$(c.target).parent().parent().parent().parent().parent();var d=a.find("a[pid]").first().attr("pid");var b=reviewsPresenter.getReviewBlock(d);if(b.is(":visible")){reviewsPresenter.hideReview(b)}else{a.find(".product-comments").html(b);b.find(".review-rating").attr("userRating",0);reviewsPresenter.refreshRating(b,0);reviewsPresenter.showAverageRating(b);reviewsPresenter.currentReviewFB=firebase.$.child("reviews/"+d);reviewsPresenter.currentReviewFB.on("child_added",reviewsPresenter.addReview);b.show("blind")}},hideReview:function(a){if(reviewsPresenter.currentReviewFB!=null){reviewsPresenter.currentReviewFB.off("child_added",reviewsPresenter.addReview);reviewsPresenter.currentReviewFbUrl=null}if(a!=null&&a.is(":visible")){a.hide("blind");a.find(".review-comments").html("")}},saveReview:function(h){var l=$(h.target).parent().parent().parent().parent().parent();var g=l.find(".review-add-comment").val();if(g.trim()!=""){var a=new Date();var j=a.getHours()>=12?"PM":"AM";var b=a.getHours()%12;b=b==0?12:b;b=reviewsPresenter.addZero(b);var f=reviewsPresenter.addZero(a.getMinutes());var m=(a.getMonth()+1)+"/"+a.getDate()+"/"+a.getFullYear()+" "+b+":"+f+" "+j;var d=firebase.username==null?"Guest":firebase.username;var c=l.find(".review-rating").attr("userRating");c=c==undefined?0:c;var i=l.find("a[pid]").first().attr("pid");reviewsPresenter.currentReviewFB=firebase.$.child("reviews/"+i);reviewsPresenter.currentReviewFB.push({name:d,rating:c,comment:g,date:m,sku:i});l.find(".review-add-comment").val("");var k=l.find(".review-float");reviewsPresenter.refreshRating(k,0);firebase.$.child("clositt/products/"+i+"/rc").transaction(function(e){var n=1;if(e==null){firebase.$.child("clositt/products/"+i+"/rc").set(n)}else{n=e+1}l.find(".numReviews").text(n);return n})}else{Messenger.info("Please enter a comment")}},addReview:function(a){var b=a.val();if(b!=null){var c=reviewsPresenter.getReviewBlock(b.sku);if(!c.find(".review-comments > li").length){c.find(".review-comments").html("")}c.find(".review-comments").append($("<li>").append(reviewsPresenter.getReviewHeader(b)).append($("<span>").addClass("review-text").append($("<span>").addClass("review-comment-user").text(b.name+": ")).append($("<pre>").text(b.comment))));reviewsPresenter.showAverageRating(c)}},getReviewHeader:function(c){var a=reviewsPresenter.isDateToday(c.date);var d=c.date.indexOf(" ");var b="";if(a){b=c.date.substring(d+1)}else{b=c.date.substring(0,d)}return $("<div>").addClass("review-header").append($("<span>").addClass("review-comment-date").text(b)).append(reviewsPresenter.getReviewRating(c.rating))},getReviewRating:function(b){var a=$("<span>").addClass("review-comment-rating").attr("rating",b);var d=0;if(b==null||b<=0||b>5){return null}for(var c=1;c<=b;c++){a.append($("<i>").addClass("star-small-full"));d++}if(d<5&&b%0.5==1){a.append($("<i>").addClass("star-small-half"));d++}while(d<5){a.append($("<i>").addClass("star-small-empty"));d++}return a},showAverageRating:function(b){return null;var a=reviewsPresenter.getAverageRating(b);if(a>=0&&a<=5){b.find(".review-average").text(a);b.find(".review-average").show()}else{b.find(".review-average").text(0);b.find(".review-average").hide()}},getAverageRating:function(c){var a=0;var b=0;c.find(".review-comments .review-comment-rating").each(function(){var e=$(this).attr("rating");e=e<0?0:e;e=e>5?5:e;a+=parseFloat(e);b++});if(b>0){var d=a/b;return Math.round(d*10)/10}return -1},showFilledStars:function(d){var c=$(d.target).attr("star");c=c>5?5:c;var b=$(".review-rating").attr("userRating");if(b==undefined||isNaN(b)||b<=0){var a=$(d.target).parent().parent().parent();reviewsPresenter.refreshRating(a,c)}},refreshRating:function(d,c){c=parseFloat(c);var b=0;for(var a=1;a<=c;a++){var e=d.find('.review-rating .review-star[star="'+a+'"]');e.removeClass("star-small-empty star-small-half");e.addClass("star-small-full");b++}if(b<5&&c%0.5==1){var e=d.find('.review-rating .review-star[star="'+b+'"]');e.removeClass("star-small-empty star-small-full");e.addClass("star-small-half");b++}for(var a=b+1;a<=5;a++){var e=d.find('.review-rating .review-star[star="'+a+'"]');e.removeClass("star-small-full star-small-half");e.addClass("star-small-empty")}},chooseRating:function(c){var b=$(c.target).attr("star");if($(".review-rating").attr("userRating")==b){b=0}$(".review-rating").attr("userRating",b);var a=$(c.target).parent().parent().parent();reviewsPresenter.refreshRating(a,b)},resetRating:function(c){var a=$(c.target).parent().parent().parent();var b=a.find(".review-rating").attr("userRating");if(b==undefined||isNaN(b)||b<=0){reviewsPresenter.refreshRating(a,0)}else{reviewsPresenter.refreshRating(a,b)}},getReviewBlock:function(d){if(reviewsPresenter.cachedReviews[d]!=null){return reviewsPresenter.cachedReviews[d]}var c=$("<div>").addClass("review-rating");for(var a=1;a<=5;a++){c.append($("<i>").addClass("review-star star-small-empty").attr("star",a))}var b=$("<div>").attr("id",d+"-review-float").addClass("review-float").css("display","none").append($("<div>").addClass("review-form").append($("<textarea>").addClass("review-add-comment").attr("rows","3").attr("placeholder","Add a Comment...")).append(c).append($("<button>").addClass("review-add-btn btn btn-success btn-mini").attr("type","button").text("Add Comment"))).append($("<ul>").addClass("review-comments"));reviewsPresenter.cachedReviews[d]=b;return b},isDateToday:function(c){var b=new Date(c);var a=new Date();return b.getUTCFullYear()==a.getUTCFullYear()&&b.getUTCMonth()==a.getUTCMonth()&&b.getUTCDate()==a.getUTCDate()},addZero:function(a){if(isNaN(a)){a=0}if(a<10){a="0"+a}return a}};var closetPresenter={share:"1212000",carouselLeft:null,carouselRight:null,user:null,init:function(){var a=closetPresenter.user==undefined?undefined:closetPresenter.user.toString().replace(closetPresenter.share,"");closetPresenter.getClosets(a);$(document).on("mousedown",".carousel-left",closetPresenter.leftAnimation);$(document).on("mousedown",".carousel-right",closetPresenter.rightAnimation);$(document).on("mouseup",".carousel-left",closetPresenter.stopCarouselLeft);$(document).on("mouseup",".carousel-right",closetPresenter.stopCarouselRight);$("#closet-settings > .settings-minicon").on("click",closetPresenter.showSettings);$(document).on("click","#closet-settings > .save-minicon",closetPresenter.saveClosets);$(document).on("click","#closet-share > .share-freeiconsweb",closetPresenter.shareCloset);$(document).on("click",".delete-outfit",closetPresenter.removeOutfit);$(document).keypress(closetPresenter.saveClosetsOnEnter)},setUser:function(a){closetPresenter.user=a},getClosets:function(){if(closetPresenter.user!=undefined){firebase.$.child(firebase.userPath).child(closetPresenter.user).child("closets").once("value",closetPresenter.showClosets);firebase.$.child(firebase.userPath).child(closetPresenter.user).child("name").once("value",function(a){$("#user-closet-title").text(a.val()+"'s Closet")})}else{if(firebase.isLoggedIn){firebase.$.child(firebase.userPath).child(firebase.userid).child("closets").once("value",closetPresenter.showClosets);$("#user-closet-title").text(firebase.username+"'s Closet")}else{Messenger.info("Please login or sign up to add items to your closet!")}}},showClosets:function(a){a.forEach(function(b){closetPresenter.getClosetTemplate("closet-list",b,true)});$(".closetName").last().attr("last",true)},getClosetTemplate:function(g,f,c){var b=$("<div>").addClass("items");var d=Math.floor(Math.random()*3)+1;var a=d>1?"orange":d>0?"red":"";var e=null;if(c){e=$("<h1>").addClass("closetName").append($("<span>").addClass(a).attr("closetid",f.name()).text(f.val().name))}$("#"+g).append($("<hr>")).append($("<div>").addClass("closet").addClass("clearfix").append(e).append($("<div>").addClass("carousel").append($("<div>").addClass("carousel-left").append($("<div>").addClass("left-arrow"))).append(b).append($("<div>").addClass("carousel-right").append($("<div>").addClass("right-arrow")))));f.child("items").forEach(function(h){b.append(productPresenter.getClosetItemTemplate(h.val()).prepend($("<div>").addClass("hanger").append($("<img>").attr("src","css/images/hanger.png"))))})},stopCarouselLeft:function(a){$(a.currentTarget).next(".items").first().stop();$(a.currentTarget).animate({opacity:0.5},500)},stopCarouselRight:function(a){$(a.currentTarget).prev(".items").first().stop();$(a.currentTarget).animate({opacity:0.5},500)},leftAnimation:function(a){$(a.currentTarget).next(".items").first().animate({left:-1*$(document).width()-$(this).width()},7000);$(a.currentTarget).animate({opacity:1},500)},rightAnimation:function(a){$(a.currentTarget).prev(".items").first().animate({left:$(document).width()-$(this).width()},7000);$(a.currentTarget).animate({opacity:1},500)},showSettings:function(){if(!$(".settings-minicon").hasClass("active")&&$(".outfit").length>0){$(".settings-minicon").addClass("active");$("#closet-share > .share-freeiconsweb").animate({right:"+=50"},50);$("#closet-settings").prepend($("<i>").addClass("minicon-single save-minicon"));$(".picture").append($("<div>").addClass("delete-outfit").append($("<i>").addClass("icon-remove icon-white")));$(".closetName > span").replaceWith(function(){return $("<span>").append($("<input>").addClass("closetNameInput").attr("type","text").attr("name","closetName").attr("closetid",$(this).attr("closetid")).attr("original",$(this).text()).attr("value",$(this).text()))})}else{closetPresenter.hideSettings()}},hideSettings:function(){if($(".settings-minicon").hasClass("active")){$(".settings-minicon").removeClass("active");$("#closet-settings .save-minicon").remove();$("#closet-share > .share-freeiconsweb").animate({right:"-=50"},50);$(".picture .delete-outfit").remove();$(".closetName > span").replaceWith(function(){return $("<span>").attr("closetid",$(this).children("input").attr("closetid")).text($(this).children("input").attr("original"))})}},saveClosets:function(){if($(".settings-minicon").hasClass("active")){$(".closetName input").each(function(){var c=$(this).attr("closetid");var b=$(this).attr("original");var a=$(this).val().trim();var e=$(this);var d=true;firebase.$.child(firebase.userPath).child(firebase.userid).child("closets/"+c+"/name").set(a,function(f){if(f){Messenger.error("Item could not be removed."+f);d=false}else{e.attr("original",a);e.attr("value",a);if(e.parent().parent().attr("last")){if(d){Messenger.success("Closet Names were saved!");closetPresenter.hideSettings()}else{Messenger.error("Error! Closet Names were not saved!")}}}})})}},saveClosetsOnEnter:function(a){if($(".settings-minicon").hasClass("active")){if(a.which==13){closetPresenter.saveClosets()}}},removeOutfit:function(a){var d=$(a.currentTarget).prev("a").attr("pid");var c=$(a.currentTarget).parent().parent().parent().parent().prev(".closetName").find("input").attr("original");var b=$(a.currentTarget).parent().parent().parent().parent().prev(".closetName").find("input").attr("closetid");firebase.$.child(firebase.userPath).child(firebase.userid).child("closets/"+b+"/items").once("value",function(e){e.forEach(function(f){if(f.val()==d){firebase.$.child(firebase.userPath).child(firebase.userid).child("closets/"+b+"/items/"+f.name()).remove(function(g){if(g){Messenger.error("Item could not be removed."+g)}else{$(a.currentTarget).parent().parent().css("display","none");Messenger.success('This item was removed from "'+c+'"')}});return true}})})},shareCloset:function(){if($("#share-url").length){$("#share-url").remove()}else{var a=location.href.toString().replace("closet.php",("!"+closetPresenter.share)+firebase.userid);$("#closet-share > .share-freeiconsweb").before($('<input type="text">').attr("id","share-url").attr("value",a).css("position","absolute").css("top","110px").css("right","185px").css("height","30px").css("width","200px"));$("#share-url").focus()}}};var closetFormPresenter={closetIds:null,closetNames:null,closetItems:null,closetItemsMapping:null,darkHangerImg:"/css/images/hanger-icon.png",lightHangerImg:"/css/images/hanger-icon-white.png",getClosetInfo:function(){if(closetFormPresenter.closetNames==null&&firebase.isLoggedIn){firebase.$.child(firebase.userPath).child(firebase.userid).child("closets").on("value",function(b){var f=new Array();var a=new Array();var d=new Array();var e=new Array();var c=0;b.forEach(function(g){f[c]=g.name();a[c]=g.val().name;g.child("items").forEach(function(h){d.push(h.val());e.push(a[c])});c++});closetFormPresenter.closetIds=f;closetFormPresenter.closetNames=a;closetFormPresenter.closetItems=d;closetFormPresenter.closetItemsMapping=e;closetFormPresenter.markUsersClositItems()})}},showClosetForm:function(e){if(!firebase.isLoggedIn){Messenger.info("Please login or sign up to add items to your closet!")}else{if(closetFormPresenter.closetNames==null){closetFormPresenter.getClosetInfo()}var c=e.currentTarget;if($(c).parent().parent().find("form").length>0){$(c).children(".hanger-plus").addClass("icon-white");$parent=$(c).parent().parent();$parent.children(".addToClosetForm").tooltip("destroy");$parent.children(".addToClosetForm").remove();$parent.children(".addTagForm").tooltip("destroy");$parent.children(".addTagForm").remove();$parent.children(".bottom").show()}else{$(c).children(".hanger-plus").removeClass("icon-white");var a=$();for(var d=0;d<closetFormPresenter.closetNames.length;d++){var g=$("<input>").attr("type","radio").attr("name","closet").attr("value",closetFormPresenter.closetIds[d]).attr("closetName",closetFormPresenter.closetNames[d]);var b=closetFormPresenter.closetItems.indexOf($(c).children("img").attr("id").substring(7));if(b>=0&&b<closetFormPresenter.closetItemsMapping.length&&closetFormPresenter.closetNames[d]==closetFormPresenter.closetItemsMapping[b]){g.attr("checked","checked")}a=a.add($("<div>").addClass("controls").append($("<label>").addClass("radio").append(g).append($("<span>").html(closetFormPresenter.closetNames[d]))))}$(c).parent().next(".bottom").hide();$(c).parent().parent().append($("<div>").addClass("addToClosetForm").append($("<form>").append($("<div>").addClass("controls").append($("<label>").addClass("control-label").text("New Clositt: ").append($("<input>").attr("type","text").attr("name","newCloset").addClass("newCloset")))).append($("<div>").addClass("selectCloset").append(a)).append($("<input>").attr("type","submit").css("display","none"))));var f=$(c).parent().parent().children(".addToClosetForm");f.tooltip({title:"Press Enter to add item",placement:"bottom"});f.show()}}},addToCloset:function(b){b.preventDefault();var e=$(b.currentTarget).parent().parent().prev().find("a").attr("pid");var d=$(b.currentTarget).find('input[name="newCloset"]').val();var c=$(b.currentTarget).find('input[name="closet"]:checked').val();if(d.trim().length>0){d=d.trim();c=new Date().getTime();firebase.$.child(firebase.userPath).child(firebase.userid).child("closets").child(c).child("name").set(d)}else{if(c!=null){d=$(b.currentTarget).find('input[name="closet"]:checked').attr("closetName").trim()}}if(d.length>0){var a=closetFormPresenter.closetItems.indexOf(e);if(a<0||closetFormPresenter.closetItemsMapping[a]!=d){firebase.$.child(firebase.userPath).child(firebase.userid).child("closets").child(c).child("items").push(e,function(f){if(f){Messenger.error("Closet could not be saved. "+f)}else{Messenger.success('This item was added to "'+d+'"');closetFormPresenter.showClosetForm(b);closetFormPresenter.updateClosetCount(e)}})}else{Messenger.success('This item is already in your closet "'+d+'"')}}return false},markUsersClositItems:function(){if(closetFormPresenter.closetItems!=null&&firebase.isLoggedIn){var a=$("#hanger-"+closetFormPresenter.closetItems.join(", #hanger-"));a.attr("src",closetFormPresenter.darkHangerImg);a.parent().tooltip("destroy");a.parent().tooltip({title:"In my Closet"})}},updateClosetCount:function(a){firebase.$.child("clositt/products/"+a+"/cc").transaction(function(b){var c=1;if(b==null){firebase.$.child("clositt/products/"+a+"/cc").set(c)}else{c=b+1}return c})}};var colorPresenter={init:function(){$(document).on("click",".colorFilter",colorPresenter.filterColor)},filterColor:function(a){if($(a.target).hasClass("selectedColor")){$(".selectedColor").removeClass("selectedColor")}else{$(".selectedColor").removeClass("selectedColor");$(a.target).addClass("selectedColor")}filterPresenter.onFilterSelect()},getSelectedColors:function(){var a=[];$(".selectedColor").each(function(){var b=$(this).attr("data-original-title").toLowerCase();a.push(b)});return a},getColorNames:function(){var b=[];for(var a in colorPresenter.allColors){b.push(a)}return b},getColorFilters:function(){var b=$("<div>").attr("id","colorPallet");var c=null;var d=0;var e=Object.keys(colorPresenter.allColors).length;for(var a in colorPresenter.allColors){if(d%4==0){c=$("<div>").addClass("colorFilterGroup")}c.append($("<div>").addClass("colorFilter").addClass(a.toLowerCase()).addClass(colorPresenter.getShadowPositionClass(d,e)).attr("data-toggle","tooltip").attr("data-placement",colorPresenter.getTooltipPosition(d,e)).attr("data-original-title",a).css("background-color",colorPresenter.allColors[a].h));if(d%4==3){b.append(c)}d++}setTimeout(function(){$(".colorFilter").tooltip()},3000);return b},getShadowPositionClass:function(c,e){var b="";var d="";switch(c%4){case 0:d="left";break;case 1:case 2:d="middle";break;case 3:d="right";break}switch(c){case 0:case 1:case 2:case 3:b="top";break;case e-1:case e-2:case e-3:case e-4:b="bottom";break}var a="";if(b!=""&&d!=""){a=b+"-"+d}else{if(b!=""){a=b}else{a=d}}return a},getTooltipPosition:function(b,c){var a="";switch(b){case 0:case 1:case 2:a="top";break;case c-2:case c-3:case c-4:a="bottom";break}if(a==""){switch(b%4){case 0:case 1:case 2:a="top";break;case 3:a="right";break}}return a},allColors:{Red:{h:"#f33",r:255,g:51,b:51},Orange:{h:"#f93",r:255,g:153,b:51},Yellow:{h:"#ff0",r:255,g:255,b:0},Green:{h:"#3c3",r:51,g:204,b:51},Teal:{h:"#088",r:0,g:136,b:136},Blue:{h:"#00F",r:0,g:255,b:255},Purple:{h:"#939",r:153,g:51,b:153},Pink:{h:"#ff98bf",r:255,g:152,b:191},White:{h:"#f0f0f0",r:255,g:255,b:255},Grey:{h:"#999",r:153,g:153,b:153},Black:{h:"#000",r:0,g:0,b:0},Brown:{h:"#963",r:153,g:102,b:51}}};